{% if (render_mode == "full" or render_mode == "thoughts" or render_mode == "thought" or render_mode == "transform" or render_mode == "book" or render_mode == "equipment") %}
  {% if not is_plugin_loaded("SkyrimNetUDNG.esp") %}
    {% set actor_name = decnpc(actorUUID).name %}
    {% set actor_gender = lower(decnpc(actorUUID).sex) %}
    {% set bound_armor = has_spell(actorUUID, "REQ_Conjuration3_Bound_Armor") %}

    {# Arousal levels from faction rank #}
    {% set arousal_level = get_faction_rank(actorUUID, "sla_Arousal") %}
    {% if arousal_level < 35 %}
      {% set arousal_state = "not_aroused" %}
    {% else if arousal_level < 75 %}
      {% set arousal_state = "moderately_aroused" %}
    {% else %}
      {% set arousal_state = "highly_aroused" %}
    {% endif %}

    {# Nudity detection #}
    {% if worn_has_keyword(actorUUID, "Eroticarmor") or worn_has_keyword(actorUUID, "sla_armorspendex") or worn_has_keyword(actorUUID, "sla_armorhalfnakedbikini") or worn_has_keyword(actorUUID, "sla_armorhalfnaked") %}
      {% set clothing_state = "minimal" %}
    {% else if worn_has_keyword(actorUUID, "ArmorCuirass") or worn_has_keyword(actorUUID, "ClothingBody") or bound_armor %}
      {% set clothing_state = "clothed" %}
    {% else %}
      {% set clothing_state = "nude" %}
    {% endif %}

    {# Vibration capabilities and status #}
    {% set has_vibrators = (worn_has_keyword(actorUUID, "zad_DeviousPlugVaginal") or worn_has_keyword(actorUUID, "zad_DeviousPlugAnal") or worn_has_keyword(actorUUID, "zad_DeviousPiercingsNipple") or worn_has_keyword(actorUUID, "zad_DeviousPiercingsVaginal")) %}
    {% set vibrators_active = is_in_faction(actorUUID, "zadVibratorFaction") %}
  {% endif %} 

  {# speaker having sex #} 
  {% set actor_having_sex = false %} 
  {% set sexlab.threads = [] %}
  {% if get_global_value("skyrimnet_sexlab_active_sex") == 1.0 %}
      {% if not isTimePaused %}
          {% set sexlab = sexlab_get_threads(npc.UUID) -%}
          {% if not sexlab.threads %}
            {% set sexlab = read_json("SkyrimNet_SexLab/threads.json") %} 
          {% endif %}
      {% else %} 
          {% set sexlab = read_json("SkyrimNet_SexLab/threads.json") %} 
      {% endif %}
      {% for thread in sexlab.threads %}
        {% if contains(thread.names, actor_name) %} 
          {% set actor_having_sex = true %} 
        {% endif %} 
      {% endfor %}
  {% endif %} 
{% endif %} 